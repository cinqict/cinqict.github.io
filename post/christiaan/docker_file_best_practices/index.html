<!DOCTYPE html>
<html lang="nl-NL">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:image" content="/images/docker-cover1.jpg"/>
    



<meta name="twitter:title" content="Dockerfile on a Diet"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@cinqict"/>



  	<meta property="og:title" content="Dockerfile on a Diet &middot; CINQ ICT Tech Blog" />
  	<meta property="og:site_name" content="CINQ ICT Tech Blog" />
  	<meta property="og:url" content="https://cinqict.github.io/post/christiaan/docker_file_best_practices/" />

    
       <meta property="og:image" content="/images/docker-cover1.jpg"/>
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2017-12-12T14:26:26&#43;02:00" />

    
    <meta property="article:tag" content="Docker" />
    
    <meta property="article:tag" content="dockerfile" />
    
    <meta property="article:tag" content="dockercon" />
    
    

    <title>Dockerfile on a Diet &middot; CINQ ICT Tech Blog</title>

    
    <meta name="description" content="Op de eerste dag van DockerCon EU, een paar maanden geleden, was ik aanwezig bij een sessie van Abby Fuller (senior technical evangelist, AWS) over hoe efficiën" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://cinqict.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://cinqict.github.io/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://cinqict.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://cinqict.github.io/css/nav.css" />

    

    
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
    

    
      
          <link href="https://cinqict.github.io/index.xml" rel="alternate" type="application/rss+xml" title="CINQ ICT Tech Blog" />
      
      
    
    <meta name="generator" content="Hugo 0.26" />

    <link rel="canonical" href="https://cinqict.github.io/post/christiaan/docker_file_best_practices/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": ,
        "logo": https://cinqict.github.ioimages/cinq_logo.png
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "image": {
            "@type": "ImageObject",
            "url": https://cinqict.github.ioimages/cinq_logo.png,
            "width": 250,
            "height": 250
        }, 
        
        "url": http://cinqict.nl,
        "sameAs": [
            
            
             
             
             
             
             
            
        ],
        "description": my bio
        
    },
    "headline": Dockerfile on a Diet,
    "name": Dockerfile on a Diet,
    "wordCount": 582,
    "timeRequired": "PT3M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": https://cinqict.github.io/post/christiaan/docker_file_best_practices/,
    "datePublished": 2017-12-12T14:26Z,
    "dateModified": 2017-12-12T14:26Z,
    
    "image": {
        "@type": "ImageObject",
        "url": https://cinqict.github.ioimages/docker-cover1.jpg,
        "width": 3000,
        "height": 1445
    },
    
    "keywords": Docker, dockerfile, dockercon,
    "description": ,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": https://cinqict.github.io/post/christiaan/docker_file_best_practices/
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-106769321-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="https://cinqict.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



  
  <header class="main-header post-head" style="background-image: url(/images/docker-cover1.jpg)">
  
  <nav class="main-nav overlay clearfix">


  
      <a class="blog-logo" href="https://cinqict.github.io"><img src="https://cinqict.github.io/images/cinq_logo.png" alt="Home" /></a>
  
  
      <a class="menu-button icon-feed" href="https://cinqict.github.io/index.xml" >&nbsp;&nbsp;Subscribe</a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Dockerfile on a Diet</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2017-12-12T14:26:26&#43;02:00">
            Dec 12, 2017
          </time>
        
         
          <span class="post-tag small"><a href="https://cinqict.github.io/tags/docker/">#Docker</a></span>
         
          <span class="post-tag small"><a href="https://cinqict.github.io/tags/dockerfile/">#dockerfile</a></span>
         
          <span class="post-tag small"><a href="https://cinqict.github.io/tags/dockercon/">#dockercon</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p>Op de eerste dag van DockerCon EU, een paar maanden geleden, was ik aanwezig bij een sessie van <a href="https://twitter.com/abbyfuller">Abby Fuller</a> (senior technical evangelist, AWS) over hoe efficiënte Docker files geschreven kunnen worden. Dat klinkt misschien niet heel erg spannend, maar was zowel voor de beginnende als de iets meer gevorderde Docker user handig om te volgen.
Er wordt namelijk vaak vergeten dat de opzet van een Dockerfile een groot verschil kan maken op de omvang van een Docker image. En dit heeft dus ook een behoorlijke impact op de download en opstart tijden van een image. Nu ben ik zelf ook al een paar jaar met Docker bezig en gaande weg zie ook ik steeds meer dat het belangrijk is om de build van Docker images en de daarmee gepaard gaande diskspace onder controle te houden. Abby benadrukte dit nog eens door te zeggen dat deze sessie over diskspace zou gaan.</p>

<p>Bij het bouwen van een image begin je altijd met een base layer. Denk aan een CentOS, Ubuntu of Alpine. De layers uit het base image zijn read-only container layers en kan je verder niet aanpassen. Het is dus van belang om rekening te houden met de grootte van het OS en of dit aan de minimale eisen voldoet. Hoe kleiner het base image, des te kleiner zal het uiteindelijke resultaat uitvallen.</p>

<p>Bovenop het base image zitten een aantal thin layers waar je zelf de aanpassingen op maakt bij het bouwen van een Docker image. Hier ga je dus invloed op hebben. Hoe meer layers je in jouw image hebt, hoe groter deze wordt. Hierdoor duurt het langer om te pushen en te pullen vanuit een registry en zal het builden en deployen ook langer duren. Dit maakte in een oude monolitische omgeving misschien niet zoveel uit, maar in de wereld van microservices en veelvoudige builds en deployments maakt dit een groot verschil.</p>

<p>Hoe bouw ik dan een image die zo min mogelijk ruimte in zal gaan nemen?</p>

<ul>
<li>Hergebruik je base images.</li>
<li>Limiteer de data die je naar jouw image schrijft. Gebruik alleen de data die je echt nodig hebt</li>
<li>Chain je RUN statements. Gebruik bijvoorbeeld 1 RUN statement om meerdere packages te installeren.</li>
<li>Zorg dat je Docker image zoveel mogelijk gebruik maakt van caching. Bewaar je run statements voor het einde en zorg dat de wijzigingen die je moet maken aan je image zo ver mogelijk in jouw image worden uitgesteld. Hier zijn uiteraard uitzonderingen op.</li>
<li>Wisselen van gebruikers voegt layers toe. Mocht je een bepaalde user moeten gebruiken voor een package/app. Probeer dan het wisselen van user te voorkomen.</li>
<li>Vermijdt het toevoegen van grote files. Install packages kunnen worden uitgepakt, geinstalleerd    en worden verwijdert in 1 RUN statement.</li>
<li>Gebruik een base image die past bij je container. Een minimale base image zoals Alpine kan veel disk space besparen maar is niet altijd de beste keuze in verband met security, packages en functionaliteit.</li>
</ul>

<p>Als je deze regels goed hanteert ben je verzekerd van de snelst mogelijke Docker workflow in het geval van een pull/build of run.</p>

<p>Tot slot nog een paar tips van Abby om te zorgen dat een Docker eco-systeem valide blijft:</p>

<ul>
<li>Implementeer een container scanner op de (private) Docker repository.</li>
<li>Zorg dat oude images uit de repo worden verwijderd.</li>
<li>Wanneer je base images van de publieke Docker repositories gebruikt, houd dan in de gaten dat deze continu worden verbeterd en zorg dat je bij blijft.</li>
</ul>

<p>Happy Dockering !!</p>

<p>Bekijk de hele presentatie van Abby Fuller terug op YouTube:
<img src="http://img.youtube.com/vi/pPsREQbf3PA/0.jpg" alt="Abby Fuller op Dockercon" /></p>

    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="https://cinqict.github.io" style="background-image: url(https://octodex.github.com/images/topguntocat.png)"><span class="hidden">Christan Kewerkopf's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="https://cinqict.github.io">Christan Kewerkopf</a></h4>
  
  <p>Devops Cloud Engineer, Open source enthusiast. Pilot</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Amsterdam, Netherlands</span>
    <span class="author-link icon-link"><a href="www.github.com/christiankewerkopf">www.github.com/christiankewerkopf</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Dockerfile%20on%20a%20Diet&nbsp;-&nbsp;CINQ%20ICT%20Tech%20Blog&amp;url=https%3a%2f%2fcinqict.github.io%2fpost%2fchristiaan%2fdocker_file_best_practices%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcinqict.github.io%2fpost%2fchristiaan%2fdocker_file_best_practices%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fcinqict.github.io%2fpost%2fchristiaan%2fdocker_file_best_practices%2f&amp;description=Dockerfile%20on%20a%20Diet"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fcinqict.github.io%2fpost%2fchristiaan%2fdocker_file_best_practices%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "https:\/\/cinqict.github.io\/post\/christiaan\/docker_file_best_practices\/";  
this.page.identifier = "https:\/\/cinqict.github.io\/post\/christiaan\/docker_file_best_practices\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://cinqicttest.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>


  <aside class="read-next">
  
  
      <a class="read-next-story prev" style="background-image: url(/images/splunk_cover1.jpg)" href="https://cinqict.github.io/post/bas/splunklive1/">
          <section class="post">
              <h2>Splunk Live!</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">CINQ ICT Tech Blog</a> CINQ ICT All rights reserved - 2017</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://cinqict.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://cinqict.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://cinqict.github.io/js/index.js"></script>
    
</body>
</html>

